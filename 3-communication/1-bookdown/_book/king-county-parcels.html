<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Communities of Opportunity Displacement Risk Assessment</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is a report.">
  <meta name="generator" content="bookdown 0.2 and GitBook 2.6.7">

  <meta property="og:title" content="Communities of Opportunity Displacement Risk Assessment" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a report." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Communities of Opportunity Displacement Risk Assessment" />
  
  <meta name="twitter:description" content="This is a report." />
  

<meta name="author" content="Tiernan Martin, Futurewise">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="census-geographies-acs-geo-sets.html">
<link rel="next" href="vulnerability.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.8/htmlwidgets.js"></script>
<link href="libs/leaflet-0.7.7/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-0.7.7/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<link href="libs/leaflet-label-0.2.2/leaflet.label.css" rel="stylesheet" />
<script src="libs/leaflet-label-0.2.2/leaflet.label.js"></script>
<script src="libs/Proj4Leaflet-0.7.2/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-0.7.2/proj4leaflet.js"></script>
<script src="libs/leaflet-binding-1.0.2.9006/leaflet.js"></script>
<script src="libs/leaflet-providers-1.0.27/leaflet-providers.js"></script>
<script src="libs/leaflet-providers-plugin-1.0.2.9006/leaflet-providers-plugin.js"></script>
<link href="libs/leaflet-awesomemarkers-2.0.2/leaflet.awesome-markers.css" rel="stylesheet" />
<script src="libs/leaflet-awesomemarkers-2.0.2/leaflet.awesome-markers.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="data-methods.html"><a href="data-methods.html"><i class="fa fa-check"></i><b>A</b> Data Methods</a><ul>
<li class="chapter" data-level="A.1" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>A.1</b> Miscellaneous</a><ul>
<li class="chapter" data-level="A.1.1" data-path="miscellaneous.html"><a href="miscellaneous.html#seattle-boundary"><i class="fa fa-check"></i><b>A.1.1</b> Seattle Boundary</a></li>
<li class="chapter" data-level="A.1.2" data-path="miscellaneous.html"><a href="miscellaneous.html#king-county-subdivision-boundary"><i class="fa fa-check"></i><b>A.1.2</b> King County Subdivision Boundary</a></li>
<li class="chapter" data-level="A.1.3" data-path="miscellaneous.html"><a href="miscellaneous.html#tracts-in-king-county"><i class="fa fa-check"></i><b>A.1.3</b> Tracts in King County</a></li>
<li class="chapter" data-level="A.1.4" data-path="miscellaneous.html"><a href="miscellaneous.html#puget-sound-waterbodies"><i class="fa fa-check"></i><b>A.1.4</b> Puget Sound Waterbodies</a></li>
<li class="chapter" data-level="A.1.5" data-path="miscellaneous.html"><a href="miscellaneous.html#kc-tracts-without-western-waterbodies"><i class="fa fa-check"></i><b>A.1.5</b> KC Tracts Without (Western) Waterbodies</a></li>
<li class="chapter" data-level="A.1.6" data-path="miscellaneous.html"><a href="miscellaneous.html#king-county-without-western-waterbodies"><i class="fa fa-check"></i><b>A.1.6</b> King County Without (Western) Waterbodies</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="census-geographies-spatial-data.html"><a href="census-geographies-spatial-data.html"><i class="fa fa-check"></i><b>A.2</b> Census Geographies: Spatial Data</a><ul>
<li class="chapter" data-level="A.2.1" data-path="census-geographies-spatial-data.html"><a href="census-geographies-spatial-data.html#introduction"><i class="fa fa-check"></i><b>A.2.1</b> Introduction</a></li>
<li class="chapter" data-level="A.2.2" data-path="census-geographies-spatial-data.html"><a href="census-geographies-spatial-data.html#maps"><i class="fa fa-check"></i><b>A.2.2</b> Maps</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="census-geographies-acs-geo-sets.html"><a href="census-geographies-acs-geo-sets.html"><i class="fa fa-check"></i><b>A.3</b> Census Geographies: ACS Geo Sets</a><ul>
<li class="chapter" data-level="A.3.1" data-path="census-geographies-acs-geo-sets.html"><a href="census-geographies-acs-geo-sets.html#acs-geo-set"><i class="fa fa-check"></i><b>A.3.1</b> ACS Geo Set</a></li>
<li class="chapter" data-level="A.3.2" data-path="census-geographies-acs-geo-sets.html"><a href="census-geographies-acs-geo-sets.html#matching-tracts-between-the-years"><i class="fa fa-check"></i><b>A.3.2</b> Matching Tracts between the years</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="king-county-parcels.html"><a href="king-county-parcels.html"><i class="fa fa-check"></i><b>A.4</b> King County Parcels</a><ul>
<li class="chapter" data-level="A.4.1" data-path="king-county-parcels.html"><a href="king-county-parcels.html#introduction-1"><i class="fa fa-check"></i><b>A.4.1</b> Introduction</a></li>
<li class="chapter" data-level="A.4.2" data-path="king-county-parcels.html"><a href="king-county-parcels.html#parcels-in-seattle-ccd"><i class="fa fa-check"></i><b>A.4.2</b> Parcels in Seattle CCD</a></li>
<li class="chapter" data-level="A.4.3" data-path="king-county-parcels.html"><a href="king-county-parcels.html#assigning-census-tracts-to-parcels"><i class="fa fa-check"></i><b>A.4.3</b> Assigning Census Tracts to Parcels</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="vulnerability.html"><a href="vulnerability.html"><i class="fa fa-check"></i><b>A.5</b> Vulnerability</a><ul>
<li class="chapter" data-level="A.5.1" data-path="vulnerability.html"><a href="vulnerability.html#introduction-2"><i class="fa fa-check"></i><b>A.5.1</b> Introduction</a></li>
<li class="chapter" data-level="A.5.2" data-path="vulnerability.html"><a href="vulnerability.html#population-belonging-to-a-community-of-color-2010-2014"><i class="fa fa-check"></i><b>A.5.2</b> Population Belonging to A Community of Color (%), 2010-2014</a></li>
<li class="chapter" data-level="A.5.3" data-path="vulnerability.html"><a href="vulnerability.html#population-in-renter-occupied-housing-units-2010-2014"><i class="fa fa-check"></i><b>A.5.3</b> Population in Renter-Occupied Housing Units (%), 2010-2014</a></li>
<li class="chapter" data-level="A.5.4" data-path="vulnerability.html"><a href="vulnerability.html#adults-25-with-less-than-a-bachelor-degree-2010-2014"><i class="fa fa-check"></i><b>A.5.4</b> Adults 25+ With Less Than a Bachelor Degree (%), 2010-2014</a></li>
<li class="chapter" data-level="A.5.5" data-path="vulnerability.html"><a href="vulnerability.html#household-earning-less-than-80-of-the-hud-2010-2014"><i class="fa fa-check"></i><b>A.5.5</b> Household earning less than 80% of the HUD , 2010-2014</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="demographic-change-race.html"><a href="demographic-change-race.html"><i class="fa fa-check"></i><b>A.6</b> Demographic Change: Race</a><ul>
<li class="chapter" data-level="A.6.1" data-path="demographic-change-race.html"><a href="demographic-change-race.html#introduction-3"><i class="fa fa-check"></i><b>A.6.1</b> Introduction</a></li>
<li class="chapter" data-level="A.6.2" data-path="demographic-change-race.html"><a href="demographic-change-race.html#change-in-share-of-white-population-2005-2009-to-2010-2014"><i class="fa fa-check"></i><b>A.6.2</b> Change in Share of White Population (%), 2005-2009 to 2010-2014</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="demographic-change-education.html"><a href="demographic-change-education.html"><i class="fa fa-check"></i><b>A.7</b> Demographic Change: Education</a><ul>
<li class="chapter" data-level="A.7.1" data-path="demographic-change-education.html"><a href="demographic-change-education.html#introduction-4"><i class="fa fa-check"></i><b>A.7.1</b> Introduction</a></li>
<li class="chapter" data-level="A.7.2" data-path="demographic-change-education.html"><a href="demographic-change-education.html#change-in-share-of-adults-with-a-bachelor-degree-or-higher-2005-2009-to-2010-2014"><i class="fa fa-check"></i><b>A.7.2</b> Change in Share of Adults with a Bachelor Degree or Higher (%), 2005-2009 to 2010-2014</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="demographic-change-housing-tenure.html"><a href="demographic-change-housing-tenure.html"><i class="fa fa-check"></i><b>A.8</b> Demographic Change: Housing Tenure</a><ul>
<li class="chapter" data-level="A.8.1" data-path="demographic-change-housing-tenure.html"><a href="demographic-change-housing-tenure.html#introduction-5"><i class="fa fa-check"></i><b>A.8.1</b> Introduction</a></li>
<li class="chapter" data-level="A.8.2" data-path="demographic-change-housing-tenure.html"><a href="demographic-change-housing-tenure.html#change-in-share-of-home-owners-2005-2009-to-2010-2014"><i class="fa fa-check"></i><b>A.8.2</b> Change in Share of Home Owners (%), 2005-2009 to 2010-2014</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="demographic-change-income.html"><a href="demographic-change-income.html"><i class="fa fa-check"></i><b>A.9</b> Demographic Change: Income</a><ul>
<li class="chapter" data-level="A.9.1" data-path="demographic-change-income.html"><a href="demographic-change-income.html#introduction-6"><i class="fa fa-check"></i><b>A.9.1</b> Introduction</a></li>
<li class="chapter" data-level="A.9.2" data-path="demographic-change-income.html"><a href="demographic-change-income.html#change-in-share-of-moderate-to-high-income-households-2010-2014"><i class="fa fa-check"></i><b>A.9.2</b> Change in Share of Moderate to High Income Households (%), 2010-2014</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Communities of Opportunity Displacement Risk Assessment</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="king-county-parcels" class="section level2">
<h2><span class="header-section-number">A.4</span> King County Parcels</h2>
<div id="introduction-1" class="section level3">
<h3><span class="header-section-number">A.4.1</span> Introduction</h3>
<p>Tax parcels are the pieces of land associated with property value. King County appraises parcels in order to determine an estimate of the fair market value, which is then used in the process of determening taxation amounts. For the purposes of this assessment, parcels are the geographic unit of the indicator of housing market conditions: residential property value.</p>
<p>More information about the parcel dataset is available at the King County GIS Center:</p>
<ul>
<li><a href="http://www.kingcounty.gov/operations/GIS/GISData.aspx">KCGIS Center</a></li>
<li><a href="http://www5.kingcounty.gov/sdc/Metadata.aspx?Layer=parcel">Parcel Shapefile Metadata</a></li>
</ul>
</div>
<div id="parcels-in-seattle-ccd" class="section level3">
<h3><span class="header-section-number">A.4.2</span> Parcels in Seattle CCD</h3>
<p>The entire dataset of King County parcels contains 602,803 records, which makes it challenging to work with because of the file size. The methodology of this project is to compare communities to the Seattle subdivision of King County, so the first step is to extract only the parcels in that geography.</p>
<p>The unique identifier for each parcel is called a <code>PIN</code>, and it is a combination of two numeric codes: a six-digit <code>MAJOR</code> (e.g., 092503) and a four-digit <code>MINOR</code> (e.g., 5891). After creating the <code>PIN</code> the <code>PropType</code> variable from the <a href="http://info.kingcounty.gov/Assessor/DataDownload/default.aspx">KC assessor’s parcel dataset</a> is joined to the spatial dataset from the KCGIS Center.</p>
<p>The spatial dataset’s size is reduced by converting the polygon into points using the <code>rgeos::gCentroid()</code> function. <code>sp::over()</code> is then used to determine which parcels are overlayed by the Seattle CCD polygon (see this <a href="https://cran.r-project.org/web/packages/sp/vignettes/over.pdf">excellent tutorial</a> for more details on <code>sp::over()</code>). The subset is exported, retaining its <code>SpatialPointsDataFrame</code> class.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Seattle subdivision of King County, WA (Seattle CCD)</span>
sea_ccd &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn =</span> <span class="kw">root_file</span>(<span class="st">&#39;1-data/4-interim/seattle_ccd.gpkg&#39;</span>),<span class="dt">layer =</span> <span class="st">&quot;seattle&quot;</span>,<span class="dt">verbose =</span> <span class="ot">FALSE</span>) %&gt;%<span class="st"> </span><span class="kw">spTransform</span>(crs_proj)

<span class="co"># Parcels (tabular data only)</span>
if(!<span class="kw">file.exists</span>(<span class="kw">root_file</span>(<span class="st">&#39;1-data/3-external/EXTR_Parcel.csv&#39;</span>))){
        url &lt;-<span class="st"> &#39;http://aqua.kingcounty.gov/extranet/assessor/Parcel.zip&#39;</span> <span class="co"># direct URL to the file download</span>
        
        temp &lt;-<span class="st"> </span><span class="kw">tempfile</span>() <span class="co"># create a temporary file to hold the compressed download</span>
        
        <span class="kw">download</span>(url, <span class="dt">dest =</span> temp, <span class="dt">mode=</span><span class="st">&#39;wb&#39;</span>) <span class="co"># download the file</span>
        
        <span class="kw">unzip</span> (temp, <span class="dt">exdir =</span> <span class="kw">root_file</span>(<span class="st">&#39;1-data/3-external/&#39;</span>)) <span class="co"># extract the file to the project folder</span>
}

prcl_all_df &lt;-<span class="st"> </span>
<span class="st">        </span><span class="kw">read_csv</span>(<span class="kw">root_file</span>(<span class="st">&#39;1-data/3-external/EXTR_Parcel.csv&#39;</span>),<span class="dt">progress =</span> <span class="ot">FALSE</span>) %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">PIN =</span> <span class="kw">paste0</span>(Major,Minor)) %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">select</span>(PIN, PropType,CurrentZoning,CurrentUseDesignation)

<span class="kw">colnames</span>(prcl_all_df) %&lt;&gt;%<span class="st"> </span><span class="kw">toupper</span>() 

<span class="co"># Parcels (sp): most recent (August, 2016)</span>

if(!<span class="kw">file.exists</span>(<span class="kw">root_file</span>(<span class="st">&#39;1-data/3-external/parcel/parcel.shp&#39;</span>))){
        url &lt;-<span class="st"> &#39;ftp://ftp.kingcounty.gov/gis-web/web/GISData/parcel_SHP.zip&#39;</span> <span class="co"># direct URL to the file download</span>
        
        temp &lt;-<span class="st"> </span><span class="kw">tempfile</span>() <span class="co"># create a temporary file to hold the compressed download</span>
        
        <span class="kw">download</span>(url, <span class="dt">dest =</span> temp, <span class="dt">mode=</span><span class="st">&#39;wb&#39;</span>) <span class="co"># download the file</span>
        
        <span class="kw">unzip</span> (temp, <span class="dt">exdir =</span> <span class="kw">root_file</span>(<span class="st">&#39;1-data/3-external/&#39;</span>)) <span class="co"># extract the file to the project folder</span>
}

<span class="co"># Load the parcel file</span>
<span class="co"># WARNING: large file with long load time</span>

<span class="co"># Make the data</span>
if(!<span class="kw">file.exists</span>(<span class="kw">root_file</span>(<span class="st">&#39;1-data/4-interim/prcl-ccd-ptdf-sp.gpkg&#39;</span>))){
        prcl_all_sp &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn =</span> <span class="kw">root_file</span>(<span class="st">&#39;1-data/3-external/parcel/&#39;</span>),<span class="dt">layer =</span> <span class="st">&#39;parcel&#39;</span>,<span class="dt">verbose =</span> <span class="ot">FALSE</span>) 
        
        prcl_all_sp@data %&lt;&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">PIN =</span> <span class="kw">as.character</span>(PIN))
        
        <span class="co"># prcl_all_sp %&lt;&gt;% spTransform(crs_proj)   # this reprojection is prohibively slow </span>
        
        join_df &lt;-<span class="st"> </span>prcl_all_sp@data %&gt;%<span class="st"> </span><span class="kw">as.data.frame</span>() %&gt;%<span class="st"> </span><span class="kw">left_join</span>(.,prcl_all_df, <span class="dt">by =</span> <span class="st">&quot;PIN&quot;</span>)
        
        
        <span class="co"># Collect the centroids of all the KC parcels (and transform their CRS to match the project CRS)</span>
        prcl_all_pt_sp &lt;-<span class="st"> </span>prcl_all_sp %&gt;%<span class="st"> </span>rgeos::<span class="kw">gCentroid</span>(<span class="dt">byid =</span> T) %&gt;%<span class="st"> </span><span class="kw">spTransform</span>(crs_proj)
        
        
        
        prcl_all_ptdf_sp &lt;-<span class="st"> </span><span class="kw">SpatialPointsDataFrame</span>(prcl_all_pt_sp,join_df,<span class="dt">match.ID =</span> <span class="ot">FALSE</span>)
        
        sea_ccd_poly &lt;-<span class="st"> </span><span class="kw">SpatialPolygons</span>(<span class="dt">Srl =</span> sea_ccd@polygons,<span class="dt">proj4string =</span> crs_proj) 
        
        <span class="co"># Using the sp::over </span>
        pts_over &lt;-<span class="st"> </span>prcl_all_pt_sp %&gt;%<span class="st"> </span>sp::<span class="kw">over</span>(sea_ccd_poly) 
        <span class="co"># prcl_ccd_sp &lt;- prcl_all_sp[which(!is.na(pts_over)),] %&gt;% spTransform(crs_proj) # slow</span>
        prcl_ccd_pt_sp &lt;-<span class="st"> </span>prcl_all_pt_sp[<span class="kw">which</span>(!<span class="kw">is.na</span>(pts_over)),]
        prcl_ccd_ptdf_sp &lt;-<span class="st"> </span>prcl_all_ptdf_sp[<span class="kw">which</span>(!<span class="kw">is.na</span>(pts_over)),]
        
        prcl_ccd_ptdf_sp %&gt;%<span class="st"> </span>
<span class="st">                </span><span class="kw">writeOGR</span>(<span class="dt">dsn =</span> <span class="kw">root_file</span>(<span class="st">&#39;1-data/4-interim/prcl-ccd-ptdf-sp.gpkg&#39;</span>),
                         <span class="dt">layer =</span> <span class="st">&#39;prcl_ccd_ptdf_sp&#39;</span>,<span class="dt">driver =</span> <span class="st">&#39;GPKG&#39;</span>,
                         <span class="dt">verbose =</span> <span class="ot">FALSE</span>,
                         <span class="dt">overwrite_layer =</span> <span class="ot">TRUE</span>)
        
        
        <span class="kw">rm</span>(prcl_all_sp)
}

<span class="co"># Load the data</span>
if(!<span class="kw">exists</span>(<span class="st">&#39;prcl_ccd_ptdf_sp&#39;</span>)){
        prcl_ccd_ptdf_sp &lt;-<span class="st"> </span>
<span class="st">        </span><span class="kw">readOGR</span>(<span class="dt">dsn =</span> <span class="kw">root_file</span>(<span class="st">&#39;1-data/4-interim/prcl-ccd-ptdf-sp.gpkg&#39;</span>),
                <span class="dt">layer =</span> <span class="st">&#39;prcl_ccd_ptdf_sp&#39;</span>,
                <span class="dt">verbose =</span> <span class="ot">FALSE</span>
        )
}</code></pre></div>
</div>
<div id="assigning-census-tracts-to-parcels" class="section level3">
<h3><span class="header-section-number">A.4.3</span> Assigning Census Tracts to Parcels</h3>
<p>The <code>sp::over()</code> function is used again, but this time to pass the unique identifier from the census tracts (<code>GEOID</code>) to each parcel that it overlay. This method resolves the issue of parcels that are overlayed by multiple tracts because it uses the centroid of the parcel instead of the polygon. Where the centroid is overlayed by two contiguous tract polygon boundaries only the first tract <code>GEOID</code> will be passed on.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make the data</span>
if(!<span class="kw">file.exists</span>(<span class="kw">root_file</span>(<span class="st">&#39;1-data/4-interim/prcl-ccd-tr-sp.gpkg&#39;</span>))){
        <span class="co"># Seattle CCD tracts</span>
        if(!<span class="kw">exists</span>(<span class="st">&#39;tr_ccd_sp&#39;</span>)){
                tr_ccd_sp &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn =</span> <span class="kw">root_file</span>(<span class="st">&#39;1-data/4-interim/tr-ccd-sp.gpkg&#39;</span>),
                                     <span class="dt">layer =</span> <span class="st">&#39;tr_ccd_sp&#39;</span>,
                                     <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
        }
        
        <span class="co"># Trim the data to just the GEOID variable</span>
        tr_ccd_geoid_sp &lt;-<span class="st"> </span><span class="kw">SpatialPolygonsDataFrame</span>(tr_ccd_sp,tr_ccd_sp@data[<span class="st">&#39;GEOID&#39;</span>]) %&gt;%<span class="st"> </span>
<span class="st">                </span><span class="kw">spTransform</span>(crs_proj)
        
        <span class="co"># Extract the census tract GEOID using a spatial overlay</span>
        prcl_ccd_tr_sp &lt;-<span class="st"> </span><span class="kw">SpatialPointsDataFrame</span>(prcl_ccd_ptdf_sp@coords,
                                                 <span class="kw">cbind</span>(prcl_ccd_ptdf_sp@data,
                                                      sp::<span class="kw">over</span>(prcl_ccd_ptdf_sp,tr_ccd_geoid_sp)))
        prcl_ccd_tr_sp@data %&lt;&gt;%<span class="st"> </span>
<span class="st">                </span><span class="kw">mutate</span>(<span class="dt">GEOID =</span> <span class="kw">as.character</span>(GEOID)) %&gt;%<span class="st"> </span>
<span class="st">                </span><span class="kw">select</span>(GEOID,<span class="kw">everything</span>())
        
        <span class="kw">writeOGR</span>(<span class="dt">obj =</span> prcl_ccd_tr_sp,
                 <span class="dt">dsn =</span> <span class="kw">root_file</span>(<span class="st">&#39;1-data/4-interim/prcl-ccd-tr-sp.gpkg&#39;</span>),
                 <span class="dt">layer =</span> <span class="st">&#39;prcl_ccd_tr_sp&#39;</span>,
                 <span class="dt">driver =</span> <span class="st">&#39;GPKG&#39;</span>,
                 <span class="dt">verbose =</span> <span class="ot">FALSE</span>,
                 <span class="dt">overwrite_layer =</span> <span class="ot">TRUE</span>)
}

<span class="co"># Load the data</span>
if(!<span class="kw">exists</span>(<span class="st">&#39;prcl_ccd_tr_sp&#39;</span>)){
        prcl_ccd_tr_sp &lt;-<span class="st"> </span>
<span class="st">                </span><span class="kw">readOGR</span>(<span class="dt">dsn =</span> <span class="kw">root_file</span>(<span class="st">&#39;1-data/4-interim/prcl-ccd-tr-sp.gpkg&#39;</span>),
                        <span class="dt">layer =</span> <span class="st">&#39;prcl_ccd_tr_sp&#39;</span>,
                        <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
}</code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="census-geographies-acs-geo-sets.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="vulnerability.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
