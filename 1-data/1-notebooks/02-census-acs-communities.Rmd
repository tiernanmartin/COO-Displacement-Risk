---
df_print: tibble
output:
  html_notebook:
    default
  pdf_document:
    keep_tex: yes
always_allow_html: yes
---

```{r census-acs-comms-setup, echo = FALSE, warning=FALSE,message=FALSE,comment=FALSE}
library(plyr)
library(knitr)
library(rprojroot)
library(rgdal)
library(sp)
library(rgeos)
library(tigris)
library(leaflet)
library(ggthemes)
library(magrittr)
library(stringr)
library(downloader)
library(webshot)
library(htmltools)
library(gplots)
library(ggmap)
library(shiny)
library(htmlwidgets)
library(readxl)
library(acs)
library(RColorBrewer)
library(tidyverse)
library(miscgis)
library(operator.tools)
library(leaflet.extras)
library(viridisLite)
library(sf)
root <- rprojroot::is_rstudio_project
root_file <- root$make_fix_file()
opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, comment=FALSE)

```

### COO Communities {-}

The primary geographic unit of this assessment is the [census tract](https://www.census.gov/geo/reference/gtc/gtc_ct.html). As is the case with many communities, the census geographies do not coincide exactly with the formal geographic boundary of the study's three sites, and should be considered as _spatial approximations_ of these communities.

Listed below are the geographic identifiers of the census tracts that approximate each site.

```{r census-acs-comms-files, results="asis"}

if(!exists('acs_norml_sf')){acs_norml <- read_rds(root_file('./1-data/4-interim/coo-acs-norml-sf.rds'))}

# Census tract boundaries for the 2015 data

# Rainier Valley
rv <- c("53033010001", "53033010300", "53033010401", "53033011001", "53033011002", "53033011101","53033011102", "53033011700", "53033011800", "53033011900")

# White Center
wc <- c("53033026600","53033026700","53033026500","53033026801","53033026802","53033027000")

# SeaTac/Tukwila

stc_hus <- read_csv(root_file('1-data/3-external/manual/seatac-tr/DEC_10_SF1_H1/DEC_10_SF1_H1_with_ann.csv'), 
                    col_types = cols(Id2 = col_character()), skip = 1)

tuk_hus <- read_csv(root_file('1-data/3-external/manual/tukwila-tr/DEC_10_SF1_H1/DEC_10_SF1_H1_with_ann.csv'), 
    col_types = cols(Id2 = col_character()), 
    skip = 1)

stc <-  paste(substr(x = stc_hus$Id2,1,2),substr(x = stc_hus$Id2,8,16),sep = "")

tuk <-  paste(substr(x = tuk_hus$Id2,1,2),substr(x = tuk_hus$Id2,8,16),sep = "")

stctuk <- c(stc,tuk)

# Census tract boundaries for the 2009 data

if(!exists('cw')){cw <- read_rds(root_file('1-data/4-interim/cw-2000-2010.rds'))}

get_GEOID2009 <- function(geoids_2015, cw){
        # browser()
        cw %>% 
                filter(GEOID_2010 %in% geoids_2015) %>% 
                filter(WEIGHT > .01) %>%
                extract2('GEOID_2000') %>% unique()
}

if(!file.exists(root_file('1-data/4-interim/coo-comm-tr-df.rds'))){
        list(
                'RV_2009' = get_GEOID2009(rv,cw),
                'RV_2015' = rv,
                'WC_2009' = get_GEOID2009(wc,cw),
                'WC_2015' = wc,
                'STKW_2009' = get_GEOID2009(stctuk,cw),
                'STKW_2015' = stctuk
        ) %>% 
                miscgis::cbind_fill(.) %>%
                as_tibble() %>%
                set_colnames(
                        c(
                                "Rainier Valley (2009)",
                                "Rainier Valley (2015)",
                                "White Center (2009)",
                                "White Center (2015)",
                                "SeaTac/Tukwila (2009)",
                                "SeaTac/Tukwila (2015)"
                        )
                ) %>% 
                write_rds(root_file('1-data/4-interim/coo-comm-tr-df.rds'))
}

read_rds(root_file('1-data/4-interim/coo-comm-tr-df.rds')) %>% 
        knitr::kable(caption = "Census Tract GEOIDs")

```

```{r census-acs-comms-combined-geoms}

```

