---
df_print: tibble
output:
  html_notebook:
    default
  pdf_document:
    keep_tex: yes
always_allow_html: yes
---

```{r census-acs-setup, echo = FALSE, warning=FALSE,message=FALSE,comment=FALSE}
library(plyr)
library(knitr)
library(rprojroot)
library(rgdal)
library(sp)
library(rgeos)
library(tigris)
library(leaflet)
library(ggthemes)
library(magrittr)
library(stringr)
library(downloader)
library(webshot)
library(htmltools)
library(gplots)
library(ggmap)
library(shiny)
library(htmlwidgets)
library(readxl)
library(acs)
library(RColorBrewer)
library(tidyverse)
library(miscgis)
library(operator.tools)
library(leaflet.extras)
library(viridisLite)
library(sf)
root <- rprojroot::is_rstudio_project
root_file <- root$make_fix_file()
opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, comment=FALSE)

```

```{r census-acs-colors}
green <- miscgis::miscgis_pals$tableau_cat[["green"]]
blue <- miscgis::miscgis_pals$tableau_cat[["blue"]]
orange <- miscgis::miscgis_pals$tableau_cat[["orange"]]
red <- miscgis::miscgis_pals$tableau_cat[["red"]]
teal <- miscgis::miscgis_pals$tableau_cat[["teal"]]
pal_rgb_4 <- miscgis::miscgis_pals$tableau_cat[c("red","gold","green","blue")] %>% unlist %>% palette()
pal_rgb_4 <- miscgis::miscgis_pals$tableau_cat[c("red","gold","green","blue")] %>% unlist %>% palette()
pal_rgb_6 <- miscgis::miscgis_pals$tableau_cat[c("red","gold","green","blue","orange","purple")] %>% unlist %>% palette()
pal_rgb_6 <- miscgis::miscgis_pals$tableau_cat[c("red","gold","green","blue","orange","purple")] %>% unlist %>% palette()
```

### ACS Geo Set
This geoset is mixture of geography type including:

  * tracts, King County
  * combined tracts, each COO community individually and all three combined together
  * county subdivision, Seattle CCD
  
```{r census-acs, echo = TRUE}

# Setup the ACS geographies: King County (tracts), Seattle CCD (), COO Communities (tracts)
# -----------------------------------------------------------------------------

coo_geos_sf <- read_rds(root_file('1-data/4-interim/coo-geos-sf.rds')) 

get_geoid <- function(x,nm){
        x %>% filter(NAME %in% nm & !is.na(GEOID6)) %>% select(GEOID6) %>% unlist(use.names = FALSE) %>% as.numeric
}

tr_rv <- get_geoid(coo_geos_sf,'RV')
tr_wc <- get_geoid(coo_geos_sf,'WC')
tr_stkw <- get_geoid(coo_geos_sf,'STKW')
tr_coo <- get_geoid(coo_geos_sf, c('RV','WC','STKW'))


# Final Object
coo_geo_acs <- c(
        acs::geo.make(state = "WA",county = "King"),
        acs::geo.make(state = "WA", county = "King",county.subdivision = "Seattle CCD"),
        acs::geo.make(state = "WA",county = "King", tract = "*"),
        acs::geo.make(state = "WA",county = "King", tract = tr_rv, combine = TRUE, combine.term = 'RV'),
        acs::geo.make(state = "WA",county = "King", tract =tr_wc, combine = TRUE, combine.term = 'WC'),
        acs::geo.make(state = "WA",county = "King", tract = tr_stkw, combine = TRUE, combine.term = 'STKW'),
        acs::geo.make(state = "WA",county = "King", tract = tr_coo, combine = TRUE, combine.term = 'COO')
) %>%  
        write_rds(root_file('1-data/4-interim/coo-geo-acs.rds'))

```
